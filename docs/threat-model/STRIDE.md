# Анализ угроз по методологии STRIDE

## Матрица угроз для потоков данных

| Элемент DFD | Угроза | Категория STRIDE | Контроль | Ссылка на NFR | Обоснование / Проверка |
|-------------|---------|------------------|----------|---------------|------------------------|
| **F1: Запрос на логин** | Подбор пароля (Brute-force) | **S**poofing | Rate limiting + хэширование паролей | **NFR-05**, **NFR-06** | BDD: "Защита от массового добавления" + аудит неудачных попыток |
| **F1: Запрос на логин** | Перехват учетных данных | **I**nformation Disclosure | TLS 1.3, HTTPS обязателен | - | Сканирование SSL/TLS конфигурации |
| **F2: Добавление цитаты** | Массовое создание цитат (спам) | **D**oS | Rate limiting на уровне API Gateway | **NFR-05** | BDD: "Защита от массового добавления", метрики 429 |
| **F2: Добавление цитаты** | Внедрение вредоносного контента | **T**ampering | Валидация и санация ввода | - | SAST-сканирование, негативные тесты |
| **F3: Поисковый запрос** | SQL/NoSQL инъекция | **T**ampering, **I**nfo Disclosure | Параметризованные запросы, ORM | - | DAST-сканирование, тесты на инъекции |
| **F3: Поисковый запрос** | Утечка данных через поиск | **I**nformation Disclosure | Проверка прав доступа | **NFR-01** | Тесты авторизации, аудит запросов |
| **F4: Личные заметки** | Неавторизованный доступ | **I**nformation Disclosure | Шифрование + проверки доступа | **NFR-01** | Тесты на авторизацию, пентест |
| **F10: Шифрование цитат** | Слабый алгоритм шифрования | **I**nformation Disclosure | AES-256-GCM, управление ключами | **NFR-01** | Аудит криптографии, проверка реализации |
| **База данных цитат** | Прямой доступ к БД | **I**nformation Disclosure | Network policies, шифрование "at rest" | **NFR-01**, **NFR-04** | Сканирование уязвимостей БД |
| **Пользователь** | Отказ от создания контента | **R**epudiation | Аудит действий, логирование | - | Логи с correlation_id, временные метки |
| **Сервис Цитат** | Повышение привилегий | **E**levation of Privilege | RBAC, принцип наименьших привилегий | - | Пентест, ревью кода авторизации |
| **API Gateway** | DDoS атака | **D**oS | WAF, rate limiting, автоскейлинг | **NFR-03**, **NFR-05** | Нагрузочное тестирование, мониторинг |

## Матрица угроз для процессов

| Процесс | Угроза | Категория STRIDE | Контроль | Ссылка на NFR | Обоснование / Проверка |
|---------|---------|------------------|----------|---------------|------------------------|
| **P1: Аутентификация** | Компрометация сессии | **S**poofing | Короткий TTL JWT, refresh tokens | **NFR-06** | Тесты истечения токенов |
| **P2: Управление цитатами** | Подмена автора цитаты | **T**ampering | Проверка владельца на бэкенде | - | Тесты авторизации на уровне объекта |
| **P3: Поиск** | DoS через сложные запросы | **D**oS | Лимиты сложности запросов | **NFR-02**, **NFR-05** | Нагрузочное тестирование поиска |
| **P4: Шифрование** | Компрометация ключей | **I**nformation Disclosure | KMS, ротация ключей | **NFR-01** | Аудит управления ключами |
| **P5: Валидация ввода** | Обход валидации | **T**ampering | Многоуровневая валидация | - | Fuzz-тестирование, SAST |
| **P6: Rate Limiting** | Обход лимитов | **D**oS | Многоуровневые лимиты (IP, user, API key) | **NFR-05** | Тесты на обход лимитов |
